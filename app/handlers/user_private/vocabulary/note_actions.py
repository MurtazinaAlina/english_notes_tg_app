"""
–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–µ–π—Å—Ç–≤–∏–π —Å –∑–∞–º–µ—Ç–∫–∞–º–∏ Notes –≤ —Ä–∞–∑–¥–µ–ª–µ "–°–ª–æ–≤–∞—Ä—å".

INFO:

–ü–†–û–°–ú–û–¢–† –ó–ê–ú–ï–¢–û–ö:

1. –ï—Å—Ç—å 2 —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫:
    - –†–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞. –ó–∞–º–µ—Ç–∫–∏ —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è —Å—Ç—Ä–æ–≥–æ –ø–æ 1 —à—Ç—É–∫–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ, —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π. –í—ã–≤–æ–¥–∏—Ç—Å—è –≤—Å—è
        –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–º–µ—Ç–∫–µ. (–ù–µ –º–µ–Ω—è—Ç—å –∫–æ–¥. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø—Ä–æ–ø–∏—Å–∞–Ω—ã —Å —Ä–∞—Å—á–µ—Ç–æ–º –Ω–∞ 1 —à—Ç—É–∫—É)
    - –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤. –ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Ä–∞—Å–ø–æ–ª–∞–≥–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–º–µ—Ç–æ–∫ (N —à—Ç—É–∫), —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –æ—Ç–∫—Ä—ã—Ç—å –∏
        –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–º–µ—Ç–∫—É —É–∂–µ —Å–æ –≤—Å–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π.
2. –†–µ–∂–∏–º—ã —Å–≤–æ–±–æ–¥–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –≤ 1 –∫–ª–∏–∫, –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞–µ–º–∞—è –∑–∞–º–µ—Ç–∫–∞ (–æ–Ω–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤
   –¥—Ä—É–≥–æ–º —Ä–µ–∂–∏–º–µ –±–µ–∑ —Å–±—Ä–æ—Å–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –ø–µ—Ä–≤—É—é). –≠—Ç–æ —É–¥–æ–±–Ω–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –Ω—É–∂–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏.
3. –ü—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∑–∞–º–µ—Ç–∫–∏ –≤ state —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–ª—é—á 'show_user_notes_cbq' —Å callback_data —ç—Ç–æ–π –∑–∞–º–µ—Ç–∫–∏, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤
   callback_data –∫–Ω–æ–ø–æ–∫ –¥–ª—è –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏–π –∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∑–∞–º–µ—Ç–∫–∏.
4. –î–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ state  –ø–æ–¥ –∫–ª—é—á–æ–º "user_notes", –≤—Å–µ
   –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –æ—Ç—Ç—É–¥–∞. –ù–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –ë–î –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ/–æ—Ç–º–µ–Ω–µ –ø–æ–∏—Å–∫–∞,
   –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏/—É–¥–∞–ª–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∑–∞–º–µ—Ç–æ–∫).

–°–û–ó–î–ê–ù–ò–ï:
4. –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ —Å –ø–µ—Ä–≤—ã–º –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–¥–Ω–æ–º
   –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ, –ª–æ–≥–∏–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ–º –≤ state –∫–ª—é—á–∞ "new_note", –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ state –ø–æ—Å–ª–µ
   —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Ç–∞–º –¥–æ –≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫.

–ü–û–ò–°–ö:
5. –ü—Ä–∏ –ø–æ–∏—Å–∫–µ –≤ state –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á "notes_search_keywords" —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º –ø–æ–∏—Å–∫–∞. –ü–æ–∏—Å–∫ –≤–µ–¥–µ—Ç—Å—è –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É –∏
   —Ç–µ–∫—Å—Ç—É –∑–∞–º–µ—Ç–∫–∏.
6. –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –Ω–µ –ø—Ä–µ–¥—É—Å–º–∞—Ç—Ä–∏–≤–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫
   show_user_notes() –∫–∞–∫ –æ–¥–∏–Ω –∏–∑ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç—Ä–∏–≥–≥–µ—Ä–Ω–æ–≥–æ callback_data.

–†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï:
7. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏ –≤ state —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∫–ª—é—á–∏:
    - 'edited_note' —Å –æ–±—ä–µ–∫—Ç–æ–º —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–∏ (—É–¥–∞–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è), –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è
    –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –∑–∞–º–µ—Ç–∫–∏ –∏ –≤–µ—Ç–≤–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ —Ä–∞–±–æ—Ç—ã –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤.
    - 'note_msg' —Å —Å–æ–æ–±—â–µ–Ω–∏–µ–º —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–æ–π –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é —Ç–µ–∫—Å—Ç–∞.
8. –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–¥ –∫–ª—é—á–æ–º 'info_msg' –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ
   —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞.
9. –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –æ–¥–Ω–∏—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞—Ö (–ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±—â–∞—è –ª–æ–≥–∏–∫–∞).
10. –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ state –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∫–ª—é—á 'add_example' –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
   —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞. –ü–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ –∫–ª—é—á —É–¥–∞–ª—è–µ—Ç—Å—è, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –µ–≥–æ —É–¥–∞–ª–µ–Ω–∏–µ
   –ø—Ä–∏ –≤—ã–∑–æ–≤–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.
11. –¢–∞–∫–∂–µ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞ –≤ state —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–ª—é—á 'example_to_update_id' —Å id —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
   Context.
"""
import html
import math

from aiogram import Router, F, types
from aiogram.filters import StateFilter
from aiogram.fsm.context import FSMContext
from sqlalchemy.ext.asyncio import AsyncSession

from app.banners import banners_details
from app.database.db import DataBase
from app.database.models import Notes
from app.filters.custom_filters import ChatTypeFilter, IsKeyInStateFilter, IsKeyNotInStateFilter
from app.keyboards.inlines import get_inline_btns, get_kbds_with_navi_header_btns, get_pagination_btns
from app.utils.custom_bot_class import Bot
from app.utils.paginator import Paginator, pages
from app.common.tools import clear_auxiliary_msgs_in_chat, try_alert_msg, modify_callback_data, \
    validate_context_example, delete_last_message, update_note_msg_data, \
    delete_info_message, join_examples_in_unordered_list
from app.common.msg_templates import context_example_msg_template, note_msg_template, oops_with_error_msg_template, \
    oops_try_again_msg_template, context_validation_not_passed_msg_template, action_cancelled_msg_template
from app.common.fsm_classes import NotesFSM
from app.settings import PLUG_TEMPLATE, MIN_NOTE_TITLE_LENGTH, MIN_NOTE_TEXT_LENGTH, PER_PAGE_NOTE_TITLES


# –°–æ–∑–¥–∞—ë–º —Ä–æ—É—Ç–µ—Ä –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ —á–∞—Ç–∞ –±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
note_router = Router()

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º —Ñ–∏–ª—å—Ç—Ä, —á—Ç–æ —Å—Ç—Ä–æ–≥–æ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç
note_router.message.filter(ChatTypeFilter(['private']))


# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ—Ö –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∏—Å–∫—É) –≤ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
# –û—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
# –ó–¥–µ—Å—å –∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–∞—Ö –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–µ–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫–∞) –∏
# –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ –∏ –≤–≤–æ–¥–∞ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞).
@note_router.callback_query(F.data.startswith('my_notes_page_') | F.data.startswith('show_note_'))
async def show_user_notes(callback: types.CallbackQuery, bot: Bot, session: AsyncSession, state: FSMContext) -> None:
    """
    –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ—Ö –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∏—Å–∫—É) –≤ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞.
    –û—Ç–∫—Ä—ã—Ç–∏–µ –∑–∞–º–µ—Ç–∫–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
    –ó–¥–µ—Å—å –∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–∞—Ö –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–µ–Ω–∏—è, —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫–∞) –∏
    –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ –∏ –≤–≤–æ–¥–∞ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞).

    :param callback: Callback-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞: "my_notes_page_{page_number}", "cancel_search_notes",
                    "show_note_6:10" (–ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º)
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏:
                 'show_user_notes_cbq' —Å callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–π –∑–∞–º–µ—Ç–∫–∏ - 'my_notes_page_1'/ 'show_note_6:10';
                 'user_notes' —Å–æ —Å–ø–∏—Å–∫–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - [<Notes_object_1>, <Notes_object_2>, ...] –∏–ª–∏
                             None (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –∏–ª–∏ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è–ª–∏—Å—å);
                 'notes_search_keywords' c str –∫–ª—é—á–æ–º –¥–ª—è –ø–æ–∏—Å–∫–∞ - 'Try to find me';
                 'edited_note' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) c –æ–±—ä–µ–∫—Ç–æ–º –∑–∞–º–µ—Ç–∫–∏ - <Notes_object>;
                 'note_msg' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) c message-–æ–±—ä–µ–∫—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–∏;
                 'info_msg' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è) c message-–æ–±—ä–µ–∫—Ç–æ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è;
                 'add_example' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –ø—Ä–∏–º–µ—Ä–∞)
                 'new_note' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏) c –æ–±—ä–µ–∫—Ç–æ–º –∑–∞–º–µ—Ç–∫–∏ - <Notes_object>;
                 'title', 'text' (–µ—Å–ª–∏ –æ—Ç–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏) c str –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ç–µ–∫—Å—Ç–æ–º;
                 'note_title_view_mode' (–ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º) c True;
                 'title_mode_page' (–ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∏–∑ —Ä–µ–∂–∏–º–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º) c callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π
                    —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ (–Ω–∞ —Å–ª—É—á–∞–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    await state.set_state(None)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ callback –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä –∑–∞–º–µ—Ç–∫–∏ (—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –Ω–æ–º–µ—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –ø–æ 1 —à—Ç.)
    if 'show_note_' in callback.data:
        note_id = int(callback.data.split(':')[-1])
        note_number = int(callback.data.split(':')[0].split('_')[-1])      # –î–ª—è 'show_note_{note_number}:{Note.id}'
    else:
        note_number = int(callback.data.split('_')[-1])                    # –î–ª—è 'my_notes_page_{note_number}'

    # –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞
    search_filter = state_data.get('notes_search_keywords') if state_data.get('notes_search_keywords') else None

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∏ –ø–æ—Ä—è–¥–∫–æ–≤—ã–π –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º (–µ—Å–ª–∏ –µ—Å—Ç—å)
    title_view_mode = state_data.get('note_title_view_mode')
    title_mode_page = state_data.get('title_mode_page')

    # –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –≤ –ø–æ–∏—Å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —á–∞—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if search_filter:
        msg = await callback.message.answer(f'<b>–í—ã –∏—â–µ—Ç–µ üîé:</b> {search_filter}')
        bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)

    # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã/–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–µ–π—Å—Ç–≤–∏–π, —É–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ –∫–ª—é—á–∏ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    if state_data.get('edited_note'):                           # –í—ã–∑–æ–≤ –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        await state.clear()
        state_data = {}
        if search_filter:
            await state.update_data(notes_search_keywords=search_filter)        # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞
        if title_view_mode:
            await state.update_data(note_title_view_mode=title_view_mode)       # –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        if title_mode_page:
            await state.update_data(title_mode_page=title_mode_page)            # –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞

    if state_data.get('new_note'):                              # –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
        await state.update_data(new_note=None)

    if state_data.get('title') or state_data.get('text'):      # –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ –æ—Ç–º–µ–Ω—ã —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏
        await state.update_data(title=None, text=None)

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    caption = banners_details.vcb_descrptn_notes
    search_btn = {'–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫ ‚úñ': 'cancel_search_notes'} if search_filter else {'–ù–∞–π—Ç–∏ –∑–∞–º–µ—Ç–∫–∏ üîé': 'search_notes'}
    view_mode_btn = {'–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ üëì': 'note_change_view_mode'} if not title_view_mode else {
        '–†–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ üìí': 'note_change_view_mode'}
    btns = {
        '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É ‚ûï': 'add_new_note',
        **view_mode_btn,
        **search_btn
    }
    kbds = get_kbds_with_navi_header_btns(level=2, btns=btns, sizes=(2, 1))
    try:
        await bot.auxiliary_msgs['cbq_msg'][callback.message.chat.id].edit_caption(caption=caption, reply_markup=kbds)
    except (Exception, ) as e:
        print(e)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç callback.data —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (–¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏)
    await state.update_data(show_user_notes_cbq=callback.data)

    # –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª (–∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π) —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
    # –ü—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    user_notes = state_data.get('user_notes')
    if not user_notes:
        user_notes = await DataBase.get_user_notes(session, bot.auth_user_id[callback.message.chat.id], search_filter)
        await state.update_data(user_notes=user_notes)

    # –ï—Å–ª–∏ —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ—Ç –∑–∞–º–µ—Ç–æ–∫, —Å–æ–æ–±—â–∞–µ–º –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if not user_notes:
        msg = await callback.message.answer(text=f'–ù–∞–π–¥–µ–Ω–æ –∑–∞–º–µ—Ç–æ–∫: <b>0</b>')
        bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)
        return

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—ä–µ–∫—Ç –∑–∞–º–µ—Ç–∫–∏ –∫ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—é
    if not title_view_mode:                                                     # –î–ª—è —Ä–µ–∂–∏–º–∞ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        try:
            note = user_notes[note_number - 1]                                  # –ó–∞–±–∏—Ä–∞–µ–º –∑–∞–º–µ—Ç–∫—É –ø–æ –ø–æ—Ä—è–¥–∫–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É
        except IndexError:      # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –µ—Å–ª–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –∏ —Ç–∞–∫–æ–≥–æ –Ω–æ–º–µ—Ä–∞ –±–æ–ª—å—à–µ –Ω–µ—Ç
            note_number -= 1
            note = user_notes[note_number - 1]
    else:                                                                       # –î–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        note = list(filter(lambda x: x.id == note_id, user_notes))[0]

    # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–º–µ—Ç–∫–æ–π
    examples = join_examples_in_unordered_list(note)                            # –°–æ–µ–¥–∏–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –ø–æ —à–∞–±–ª–æ–Ω—É
    msg_text = note_msg_template.format(
        page=note_number, len_user_notes=len(user_notes), note_title=html.escape(note.title),
        note_text=html.escape(note.text), examples=examples
    )

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∑–∞–º–µ—Ç–∫–∏, –æ–∑–≤—É—á–∫–æ–π –ø—Ä–∏–º–µ—Ä–æ–≤
    btns = {
        '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å üñå': f'edit_note_{note.id}',
        '–£–¥–∞–ª–∏—Ç—å üóë': f'delete_note_{note.id}',
        'üéß –ü—Ä–∏–º–µ—Ä—ã': f'speak_note_example_{note.id}'
    }

    # –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏/–≤–æ–∑–≤—Ä–∞—Ç–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    if not title_view_mode:
        paginator = Paginator(list(user_notes), note_number, per_page=1)
        if paginator.has_previous():
            btns["‚óÄ –ü—Ä–µ–¥—ã–¥—É—â–∞—è"] = f"my_notes_page_{note_number - 1}"
        if paginator.has_next():
            btns["–°–ª–µ–¥—É—é—â–∞—è ‚ñ∂"] = f"my_notes_page_{note_number + 1}"
    else:
        btns["–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É ‚¨Ö"] = title_mode_page                          # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

    kbds = get_inline_btns(btns=btns, sizes=(2, 1, 2))

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–º–µ—Ç–∫–æ–π –≤ —á–∞—Ç
    msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)


# –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ—Ö –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∏—Å–∫—É) –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
# –ó–¥–µ—Å—å –∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–∞—Ö –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫–∞) –∏
# –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ –∏ –≤–≤–æ–¥–∞ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º).
@note_router.callback_query(F.data.startswith('note_title_view_mode_page_'))
async def note_title_view_mode(callback: types.CallbackQuery, state: FSMContext, bot: Bot, session: AsyncSession) \
        -> None:
    """
    –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤—Å–µ—Ö –∏–ª–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ –ø–æ–∏—Å–∫—É) –≤ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
    –ó–¥–µ—Å—å –∂–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–º–µ–Ω–∞—Ö –¥–µ–π—Å—Ç–≤–∏—è (—É–¥–∞–ª–µ–Ω–∏—è, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è, –ø–æ–∏—Å–∫–∞) –∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤
    –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è/–¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–æ–∫ –∏ –≤–≤–æ–¥–∞ –∫–ª—é—á–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º).

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "note_title_view_mode_page_<page_number>"
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏:
                 'show_user_notes_cbq' —Å callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–π –∑–∞–º–µ—Ç–∫–∏ - 'my_notes_page_1'/ 'show_note_6:10';
                 'user_notes' —Å–æ —Å–ø–∏—Å–∫–æ–º –æ–±—ä–µ–∫—Ç–æ–≤ –∑–∞–º–µ—Ç–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è - [<Notes_object_1>, <Notes_object_2>, ...] –∏–ª–∏
                             None (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ –∏–ª–∏ –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –º–µ–Ω—è–ª–∏—Å—å);
                 'notes_search_keywords' c str –∫–ª—é—á–æ–º –¥–ª—è –ø–æ–∏—Å–∫–∞ - 'Try to find me';
                 'new_note' (–µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—Ç –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏) c –æ–±—ä–µ–∫—Ç–æ–º –∑–∞–º–µ—Ç–∫–∏ - <Notes_object>;
                 'title', 'text' (–µ—Å–ª–∏ –æ—Ç–º–µ–Ω–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏) c str –Ω–∞–∑–≤–∞–Ω–∏–µ–º –∏ —Ç–µ–∫—Å—Ç–æ–º;
                 'note_title_view_mode' (–ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã–∑–æ–≤–µ) c True;
                 'title_mode_page' (–ø—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏, –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã–∑–æ–≤–µ) c callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π
                    —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –î–æ–±–∞–≤–ª—è–µ–º –≤ state –∫–ª—é—á —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º –∏ callback.data —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    await state.update_data(note_title_view_mode=True)
    await state.update_data(title_mode_page=callback.data)

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ (–Ω–∞ —Å–ª—É—á–∞–∏ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏–∑ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
    await state.set_state(None)

    # –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ –¥–ª—è –ø–æ–∏—Å–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    search_filter = state_data.get('notes_search_keywords') if state_data.get('notes_search_keywords') else None

    # –ü—Ä–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –≤ –ø–æ–∏—Å–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if search_filter:
        msg = await callback.message.answer(f'<b>–í—ã –∏—â–µ—Ç–µ üîé:</b> {search_filter}')
        bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É –±–∞–Ω–Ω–µ—Ä–∞
    search_btn = {'–û—Ç–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫ ‚úñ': 'cancel_search_notes'} if search_filter else {'–ù–∞–π—Ç–∏ –∑–∞–º–µ—Ç–∫–∏ üîé': 'search_notes'}
    title_view_mode = state_data.get('note_title_view_mode')
    view_mode_btn = {'–†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ üëì': 'note_change_view_mode'} if not title_view_mode else {
        '–†–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ üìí': 'note_change_view_mode'}
    btns = {
        '–î–æ–±–∞–≤–∏—Ç—å –∑–∞–º–µ—Ç–∫—É ‚ûï': 'add_new_note',
        **view_mode_btn,
        **search_btn
    }
    kbds = get_kbds_with_navi_header_btns(level=2, btns=btns, sizes=(2, 1))
    try:
        await bot.auxiliary_msgs['cbq_msg'][callback.message.chat.id].edit_reply_markup(reply_markup=kbds)
    except (Exception, ) as e:
        print(e)

    # –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ —Ä–∞–∑–¥–µ–ª (–∏–ª–∏ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π) —Å–æ—Ö—Ä–∞–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç.
    # –ü—Ä–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    user_notes = state_data.get('user_notes')
    if not user_notes:
        user_notes = await DataBase.get_user_notes(session, bot.auth_user_id[callback.message.chat.id], search_filter)
        await state.update_data(user_notes=user_notes)

    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–∑ callback.data
    page = int(callback.data.split('_')[-1])

    # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ –∑–∞–º–µ—Ç–æ–∫ –¥–ª—è —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    paginator = Paginator(list(user_notes), page, per_page=PER_PAGE_NOTE_TITLES)
    current_page_notes = paginator.get_page()

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∑–∞–º–µ—Ç–æ–∫ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –¥–æ—Å—Ç—É–ø–æ–º –∫ –∏—Ö –ø—Ä–æ—Å–º–æ—Ç—Ä—É
    for ind, note in enumerate(current_page_notes):
        note_counter = (ind + 1) + (page - 1) * PER_PAGE_NOTE_TITLES
        btns = {'üìñ –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∑–∞–º–µ—Ç–∫–µ': f'show_note_{note_counter}:{note.id}'}
        kbds = get_inline_btns(btns=btns, sizes=(2, 1, 2))
        msg_text = f"‚ñ™ –ó–∞–º–µ—Ç–∫–∞ #<b>{note_counter}</b> –∏–∑ <b>{len(user_notes)}</b>:\n<b>{str(note.title)}</b>"
        msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
        bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π
    pagi_kbds = get_pagination_btns(pages(paginator), page=page, custom_cb_data='note_title_view_mode')
    msg_text = f'–°—Ç—Ä–∞–Ω–∏—Ü–∞ <b>{page}</b> –∏–∑ <b>{paginator.pages}</b>'
    msg = await callback.message.answer(text=msg_text, reply_markup=pagi_kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)


# –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫
@note_router.callback_query(F.data.startswith('note_change_view_mode'))
async def change_note_view_mode(callback: types.CallbackQuery, state: FSMContext, bot: Bot, session: AsyncSession) \
        -> None:
    """
    –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "note_change_view_mode"
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–∞–º–∏:
                    'show_user_notes_cbq': callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏;
                    'note_title_view_mode' (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤;
                    'title_mode_page' (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤;
                    'notes_search_keywords' (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()
    notes_search_keywords = state_data.get('notes_search_keywords')     # –ö–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞
    show_user_notes_cbq = state_data.get('show_user_notes_cbq')         # callback.data –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏
    title_view_mode = state_data.get('note_title_view_mode')       # –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤

    # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –Ω–∞ —Ä–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    if title_view_mode:
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏
            current_note = show_user_notes_cbq.split(':')[0].split('_')[-1]        # show_note_{note_number}:{Notes.id}
        except AttributeError:
            await callback.answer('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É!', show_alert=True)
            return

        # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        await state.clear()

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤
        if notes_search_keywords:
            await state.update_data(notes_search_keywords=notes_search_keywords)

        # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–∫–∏
        modified_callback = await modify_callback_data(
            bot.auxiliary_msgs['cbq'][callback.message.chat.id], f'my_notes_page_{current_note}'
        )
        await show_user_notes(modified_callback, bot, session, state)

    # –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∞ —Ä–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    else:
        try:
            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–∏
            current_note_number = int(show_user_notes_cbq.split('_')[-1])                # my_notes_page_{note_number}

            # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–æ–º–µ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
            page = math.ceil(current_note_number / PER_PAGE_NOTE_TITLES)
        except AttributeError:
            await callback.answer('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–∞–º–µ—Ç–∫—É!', show_alert=True)
            return

        # –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç
        await state.clear()

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ–∏—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ —Ä–µ–∂–∏–º–æ–≤
        if notes_search_keywords:
            await state.update_data(notes_search_keywords=notes_search_keywords)

        # –í—ã–∑—ã–≤–∞–µ–º —Ñ—É–Ω–∫—Ü–∏—é –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        modified_callback = await modify_callback_data(callback, f'note_title_view_mode_page_{page}')
        await note_title_view_mode(modified_callback, state, bot, session)


# –£–î–ê–õ–ï–ù–ò–ï –ó–ê–ú–ï–¢–ö–ò

# –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
@note_router.callback_query(F.data.startswith('delete_note_'))
async def delete_note_ask_confirm(callback: types.CallbackQuery, state: FSMContext, bot: Bot, session: AsyncSession) \
        -> None:
    """
    –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "delete_note_<Notes.id>"
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "show_user_notes_cbq" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–º–µ—Ç–∫–∏ –∏–∑ callback-–∑–∞–ø—Ä–æ—Å–∞ –∏ –æ–±—ä–µ–∫—Ç –∏–∑ –ë–î
    note_id_to_delete = int(callback.data.replace('delete_note_', ''))
    note_to_delete = await DataBase.get_note_by_id(session, note_id_to_delete)

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
    state_data = await state.get_data()
    show_user_notes_cbq = state_data.get('show_user_notes_cbq')

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã
    msg_text = f'‚ö†Ô∏è –í—ã –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∑–∞–º–µ—Ç–∫—É <b>"{note_to_delete.title}"</b>?'
    btns = {'–£–¥–∞–ª–∏—Ç—å üóë': f'confirm_delete_note_{note_id_to_delete}', '–û—Ç–º–µ–Ω–∞ ‚ùå': show_user_notes_cbq}
    kbds = get_inline_btns(btns=btns)
    msg = await callback.message.answer(msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)


# –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 2, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –∑–∞–º–µ—Ç–æ–∫
@note_router.callback_query(F.data.startswith('confirm_delete_note_'))
async def delete_note_get_confirm(callback: types.CallbackQuery, session: AsyncSession, state: FSMContext, bot: Bot) \
        -> None:
    """
    –£–¥–∞–ª–µ–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 2, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "confirm_delete_note_<Notes.id>"
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "show_user_notes_cbq" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :return: None
    """

    # –ü–æ–ª—É—á–∞–µ–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–º–µ—Ç–∫–∏ –∏–∑ callback-–∑–∞–ø—Ä–æ—Å–∞
    note_id_to_delete = int(callback.data.replace('confirm_delete_note_', ''))

    # –£–¥–∞–ª—è–µ–º –∑–∞–º–µ—Ç–∫—É –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
    try:
        is_deleted = await DataBase.delete_note_by_id(session, note_id_to_delete)

        # –í—ã–≤–æ–¥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –∏ —É–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
        if is_deleted:
            await callback.answer(f'‚úÖ –ó–∞–º–µ—Ç–∫–∞ "{is_deleted}" —É–¥–∞–ª–µ–Ω–∞', show_alert=True)
            await callback.bot.delete_message(chat_id=callback.message.chat.id, message_id=callback.message.message_id)

            # –£–¥–∞–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–º–µ—Ç–∫–∞—Ö –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            await state.update_data(user_notes=None)

            # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            state_data = await state.get_data()
            redirect_page = state_data.get('title_mode_page') if state_data.get(
                'note_title_view_mode') else state_data.get('show_user_notes_cbq')

            # –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–∞ –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            modified_callback = await modify_callback_data(callback, redirect_page)
            if state_data.get('note_title_view_mode'):
                await note_title_view_mode(modified_callback, state, bot, session)
            else:
                await show_user_notes(modified_callback, bot, session, state)

        # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—à–∏–±–∫—É, –µ—Å–ª–∏ –∑–∞–º–µ—Ç–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
        else:
            await callback.answer('‚ö†Ô∏è –£–ø—Å, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑', show_alert=True)

    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∏—Å–∫–ª—é—á–µ–Ω–∏—è
    except (Exception, ) as e:
        await callback.answer(f'‚ö†Ô∏è –£–ø—Å, —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫!\n–û—à–∏–±–∫–∞: {str(e)}\n', show_alert=True)


# –î–û–ë–ê–í–õ–ï–ù–ò–ï –ù–û–í–û–ô –ó–ê–ú–ï–¢–ö–ò

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞
@note_router.callback_query(F.data == 'add_new_note')
async def add_new_note_ask_title(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –∑–∞–≥–æ–ª–æ–≤–∫–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "add_new_note"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "show_user_notes_cbq" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    :return: None
    """

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã
    state_data = await state.get_data()
    cancelling_page = state_data.get('title_mode_page') if state_data.get('note_title_view_mode') else state_data.get(
        'show_user_notes_cbq')

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    caption = banners_details.add_new_note_step_1
    btns = {'–û—Ç–º–µ–Ω–∞ ‚ùå': cancelling_page}
    kbds = get_kbds_with_navi_header_btns(level=2, btns=btns, sizes=(2, 1))
    try:
        await callback.message.edit_caption(caption=caption, reply_markup=kbds)
    except Exception as e:
        print(e)

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –±–∞–Ω–Ω–µ—Ä–æ–º –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    bot.reply_markup_save[callback.message.chat.id] = kbds
    bot.auxiliary_msgs['cbq_msg'][callback.message.chat.id] = callback.message

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–≤–æ–¥–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∑–∞–º–µ—Ç–∫–∏
    await state.set_state(NotesFSM.title)


# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 2, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏
@note_router.message(NotesFSM.title, IsKeyNotInStateFilter('edited_note'))
async def add_new_note_get_title_ask_text(message: types.Message, bot: Bot, state: FSMContext) -> None:
    """
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 2, –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º –∑–∞–º–µ—Ç–∫–∏
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM, —Å—Ç—Ä–æ–≥–æ –ë–ï–ó –∫–ª—é—á–∞ 'edited_note'
    :return: None
    """

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É –∑–∞–≥–æ–ª–æ–≤–∫–∞
    if len(message.text) < MIN_NOTE_TITLE_LENGTH:
        msg_text = f'‚ö†Ô∏è –£–ø—Å! –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–º–µ—Ç–∫–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ {MIN_NOTE_TITLE_LENGTH} —Å–∏–º–≤–æ–ª–æ–≤!'
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        await bot.delete_message(message.chat.id, message.message_id)
        return

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    await state.update_data(title=message.text)

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä
    caption = banners_details.add_new_note_step_2
    try:
        await bot.auxiliary_msgs['cbq_msg'][message.chat.id].edit_caption(
            caption=caption, reply_markup=bot.reply_markup_save[message.chat.id]
        )
    except (Exception, ) as e:
        print(e)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏
    await state.set_state(NotesFSM.text)


# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 3, —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
@note_router.message(NotesFSM.text, IsKeyNotInStateFilter('edited_note'))
async def add_new_note_get_text_ask_example(message: types.Message, bot: Bot, state: FSMContext) -> None:
    """
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 3, —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø—Ä–æ—Å –ø–µ—Ä–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –∑–∞–º–µ—Ç–∫–∏
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM, —Å—Ç—Ä–æ–≥–æ –ë–ï–ó –∫–ª—é—á–∞ 'edited_note'
    :return: None
    """

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–ª–∏–Ω—É —Ç–µ–∫—Å—Ç–∞
    if len(message.text) < MIN_NOTE_TEXT_LENGTH:
        msg_text = f'‚ö†Ô∏è –£–ø—Å! –¢–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –Ω–µ –º–µ–Ω–µ–µ {MIN_NOTE_TEXT_LENGTH} —Å–∏–º–≤–æ–ª–æ–≤!'
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        await bot.delete_message(message.chat.id, message.message_id)
        return

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç –∑–∞–º–µ—Ç–∫–∏ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    await state.update_data(text=message.text)

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä
    caption = banners_details.add_new_note_step_3
    try:
        await bot.auxiliary_msgs['cbq_msg'][message.chat.id].edit_caption(
            caption=caption, reply_markup=bot.reply_markup_save[message.chat.id]
        )
    except Exception as e:
        print(e)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–≤–æ–¥–∞ –ø—Ä–∏–º–µ—Ä–∞
    await state.set_state(NotesFSM.example)


# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 4, –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É + –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É
# (–≤–µ—Ç–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ –Ω–∞–ª–∏—á–∏—é –∫–ª—é—á–∞ "new_note" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ - –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤)
@note_router.message(NotesFSM.example, IsKeyNotInStateFilter('edited_note'))
async def add_new_note_get_example(message: types.Message, bot: Bot, state: FSMContext, session: AsyncSession) -> None:
    """
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 4, –∑–∞–ø–∏—Å—å –≤ –±–∞–∑—É + –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É.
    –í–µ—Ç–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ –Ω–∞–ª–∏—á–∏—é –∫–ª—é—á–∞ "new_note" –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ - –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å, —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –∏–ª–∏ 1 —Å–∏–º–≤–æ–ª–æ–º –¥–ª—è –∑–∞–≥–ª—É—à–∫–∏ (—Ç–æ–≥–¥–∞ –ø—Ä–∏–º–µ—Ä –Ω–µ –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è)
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏, –∫–ª—é—á–æ–º "show_user_notes_cbq" –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –∫
           –∑–∞–º–µ—Ç–∫–∞–º –∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∫–ª—é—á–æ–º "new_note" –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∫ —É–∂–µ —Å–æ–∑–¥–∞–Ω–Ω–æ–π –∑–∞–º–µ—Ç–∫–µ.
           –°—Ç—Ä–æ–≥–æ –ë–ï–ó –∫–ª—é—á–∞ 'edited_note' –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –ª–æ–≥–∏–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ —Å –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –∑–∞–º–µ—Ç–∫–∏ –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏.
           –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ - —Å –∫–ª—é—á–æ–º 'note_title_view_mode' –ø—Ä–∏ —Ä–µ–∂–∏–º–µ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º.
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ï—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–Ω 1 —Å–∏–º–≤–æ–ª - –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –∫ –∑–∞–≥–ª—É—à–∫–µ –¥–ª—è –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ –≤ –ë–î
    examples = message.text if len(message.text) > 1 else PLUG_TEMPLATE

    # –î–µ–ª–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–≤–æ–¥–∞ (–µ—Å–ª–∏ –Ω–µ –∑–∞–≥–ª—É—à–∫–∞), –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª—è–µ–º –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if examples != PLUG_TEMPLATE:
        if not validate_context_example(examples):
            msg_text = context_validation_not_passed_msg_template
            await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
            await bot.delete_message(message.chat.id, message.message_id)
            return

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –ø—Ä–∏–º–µ—Ä –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –∑–∞–±–∏—Ä–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    await state.update_data(examples=examples)
    state_data = await state.get_data()

    # –ï—Å–ª–∏ —ç—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ+ –ø—Ä–∏–º–µ—Ä–∞:
    if state_data.get('new_note'):

        # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –≤ –ë–î
        try:
            await DataBase.create_context_example(session, {'context': examples}, note_id=state_data['new_note'].id)
        except Exception as e:
            msg_text = oops_with_error_msg_template.format(error=str(e))
            await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
            await state.clear()
            return

        # –ü–æ–ª—É—á–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –∑–∞–º–µ—Ç–∫—É
        new_note = await DataBase.get_note_by_id(session, state_data['new_note'].id)

    # –ï—Å–ª–∏ —ç—Ç–æ –Ω–æ–≤–∞—è –∑–∞–º–µ—Ç–∫–∞ —Å –ø–µ—Ä–≤—ã–º –ø—Ä–∏–º–µ—Ä–æ–º:
    else:
        # –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—É—é –∑–∞–º–µ—Ç–∫—É —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤ –ë–î
        try:
            new_note = await DataBase.create_new_note(
                session=session, user_id=bot.auth_user_id[message.chat.id], note_data=state_data
            )
        # –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ + –≤—ã—Ö–æ–¥–∏–º –∏–∑ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
        except Exception as e:
            msg_text = oops_with_error_msg_template.format(error=str(e))
            await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
            await state.clear()
            return

    if not new_note:
        await try_alert_msg(bot, message.chat.id, oops_try_again_msg_template, if_error_send_msg=True)
        return

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    title_view_mode = state_data.get('note_title_view_mode')
    redirect_page = 'note_title_view_mode_page_1' if title_view_mode else 'my_notes_page_1'

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    caption = banners_details.add_new_note_step_4.format(title=new_note.title)
    btns = {
        '–î–æ–±–∞–≤–∏—Ç—å –µ—â—ë –ø—Ä–∏–º–µ—Ä ‚ûï': f'add_example_to_new_note_{new_note.id}',
        '–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∑–∞–ø–∏—Å—è–º': redirect_page
    }
    kbds = get_kbds_with_navi_header_btns(level=2, btns=btns, sizes=(2, 1))
    try:
        await bot.auxiliary_msgs['cbq_msg'][message.chat.id].edit_caption(
            caption=caption, reply_markup=kbds
        )
    except Exception as e:
        print(e)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
    msg_text = f'‚úÖ –ó–∞–º–µ—Ç–∫–∞ "{new_note.title}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞!'
    await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ —á–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –∑–∞–º–µ—Ç–∫–∏
    examples = '- ' + '\n- '.join([i.example for i in new_note.examples])
    msg_text = f'üìí <b>{new_note.title}</b>\n{new_note.text}\n\n<b>–ü—Ä–∏–º–µ—Ä—ã:</b>\n<i>{examples}</i>'
    msg = await message.answer(msg_text)
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(msg)

    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –¥–æ–±–∞–≤–ª—è–µ–º —Ç—É–¥–∞ —Å–æ–∑–¥–∞–Ω–Ω—É—é –∑–∞–º–µ—Ç–∫—É –Ω–∞ —Å–ª—É—á–∞–π –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤ –∏ —Ä–µ–∂–∏–º
    await state.clear()
    await state.update_data(new_note=new_note, note_title_view_mode=title_view_mode)


# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 5, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (2+) –ø—Ä–∏–º–µ—Ä–æ–≤; –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞.
@note_router.callback_query(F.data.startswith('add_example_to_new_note_'), IsKeyInStateFilter('new_note'))
async def add_example_to_note(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 5, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö (2+) –ø—Ä–∏–º–µ—Ä–æ–≤; –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "add_example_to_new_note_<Note.id>"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–∞–º–∏:
                    - "new_note" (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ): –û–±—ä–µ–∫—Ç –∑–∞–º–µ—Ç–∫–∏;
                    - "note_title_view_mode" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –Ω–∞–∑–≤–∞–Ω–∏–π –∑–∞–º–µ—Ç–æ–∫
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
    state_data = await state.get_data()
    cancelling_page = state_data.get('title_mode_page') if state_data.get('note_title_view_mode') else 'my_notes_page_1'

    # –†–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –±–∞–Ω–Ω–µ—Ä –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    caption = banners_details.add_new_note_add_example
    btns = {'–û—Ç–º–µ–Ω–∞ ‚úñ': cancelling_page}
    kbds = get_kbds_with_navi_header_btns(level=2, btns=btns, sizes=(2, 1))
    try:
        await bot.auxiliary_msgs['cbq_msg'][callback.message.chat.id].edit_caption(caption=caption, reply_markup=kbds)
    except (Exception, ) as e:
        print(e)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –ø—Ä–∏–º–µ—Ä–∞ –∫ –∑–∞–º–µ—Ç–∫–µ
    await state.set_state(NotesFSM.example)


# –ü–û–ò–°–ö –ó–ê–ú–ï–¢–û–ö

# –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
@note_router.callback_query(F.data == 'search_notes')
async def search_notes_ask_keywords(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫ - –®–ê–ì 1, –∑–∞–ø—Ä–æ—Å –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "search_notes"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏:
                    - "note_title_view_mode" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
                    - "title_mode_page" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
                    - "show_user_notes_cbq" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü–æ—Å–ª–µ–¥–Ω—è—è –ø—Ä–æ—Å–º–æ—Ç—Ä–µ–Ω–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –≤ —Ä–µ–∂–∏–º–µ –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –û—á–∏—â–∞–µ–º —á–∞—Ç
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ state –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
    state_data = await state.get_data()
    cancelling_page = state_data.get('title_mode_page') if state_data.get('note_title_view_mode') else state_data.get(
        'show_user_notes_cbq')

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã
    msg_text = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –Ω–∞–∑–≤–∞–Ω–∏–∏ –∏–ª–∏ —Ç–µ–∫—Å—Ç–µ –∑–∞–º–µ—Ç–∫–∏'
    btns = {'–û—Ç–º–µ–Ω–∞ ‚úñ': cancelling_page}
    kbds = get_inline_btns(btns=btns)
    msg = await callback.message.answer(msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞
    await state.set_state(NotesFSM.search_keywords)


# –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫ - –®–ê–ì 2, –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤—ã–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫
@note_router.message(StateFilter(NotesFSM.search_keywords))
async def search_notes_get_keywords(message: types.Message, bot: Bot, state: FSMContext, session: AsyncSession) -> None:
    """
    –ü–æ–∏—Å–∫ –∑–∞–º–µ—Ç–æ–∫ - –®–ê–ì 2, –∫–ª—é—á –ø–æ–ª—É—á–µ–Ω, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤—ã–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–æ–º/—Ñ—Ä–∞–∑–æ–π –¥–ª—è –ø–æ–∏—Å–∫–∞
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏:
                    - "note_title_view_mode" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞ notes_search_keywords= –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
    notes_search_keywords = message.text
    await state.update_data(notes_search_keywords=notes_search_keywords)

    # –£–¥–∞–ª—è–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
    await state.update_data(user_notes=None)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è
    state_data = await state.get_data()
    new_callback = 'note_title_view_mode_page_1' if state_data.get('note_title_view_mode') else 'my_notes_page_1'

    # –í—ã–∑—ã–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    modified_callback = await modify_callback_data(bot.auxiliary_msgs['cbq'][message.chat.id], new_callback)
    if state_data.get('note_title_view_mode'):
        await note_title_view_mode(modified_callback, state, bot, session)
    else:
        await show_user_notes(modified_callback, bot, session, state)


# –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫
@note_router.callback_query(F.data == 'cancel_search_notes', IsKeyInStateFilter('notes_search_keywords'))
async def cancel_search_notes(callback: types.CallbackQuery, bot: Bot, state: FSMContext, session: AsyncSession) \
        -> None:
    """
    –û—Ç–º–µ–Ω–∞ –ø–æ–∏—Å–∫–∞ –∑–∞–º–µ—Ç–æ–∫.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "cancel_search_notes"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –≤–æ–∑–º–æ–∂–Ω—ã–º–∏ –∫–ª—é—á–∞–º–∏:
                    - "note_title_view_mode" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –∑–∞–º–µ—Ç–æ–∫ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    await callback.answer(action_cancelled_msg_template, show_alert=True)

    # –£–¥–∞–ª—è–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–ª—é—á –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    await state.update_data(notes_search_keywords=None, user_notes=None)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    state_data = await state.get_data()
    new_callback = 'note_title_view_mode_page_1' if state_data.get('note_title_view_mode') else 'my_notes_page_1'

    # –í—ã–∑—ã–≤–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—É—é —Ñ—É–Ω–∫—Ü–∏—é –ø–æ–∫–∞–∑–∞ –∑–∞–º–µ—Ç–æ–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞
    modified_callback = await modify_callback_data(bot.auxiliary_msgs['cbq'][callback.message.chat.id], new_callback)
    if state_data.get('note_title_view_mode'):
        await note_title_view_mode(modified_callback, state, bot, session)
    else:
        await show_user_notes(modified_callback, bot, session, state)


# –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–ï –ó–ê–ú–ï–¢–ö–ò

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏—è.
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞/—Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
@note_router.callback_query(F.data.startswith('edit_note_'))
async def edit_note_main(callback: types.CallbackQuery, bot: Bot, state: FSMContext, session: AsyncSession) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –®–ê–ì 1, –æ—Å–Ω–æ–≤–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Å –≤—ã–±–æ—Ä–æ–º –¥–µ–π—Å—Ç–≤–∏—è.
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥–æ–ª–æ–≤–∫–∞/—Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "edit_note_<Notes.id>" (–∏–ª–∏ –∏–Ω–æ–µ, –µ—Å–ª–∏ –±—ã–ª –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤)
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–∞–º–∏:
                    - "show_user_notes_cbq": –° callback.data —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤–æ–∑–≤—Ä–∞—Ç–∞
                    - "edited_note" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã–∑–æ–≤–µ –ø–æ—Å–ª–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                    - "audio_examples" (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ): –ü—Ä–∏ –≤—ã–∑–æ–≤–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ –∞—É–¥–∏–æ –ø—Ä–∏–º–µ—Ä–æ–≤ –≤ —á–∞—Ç–µ
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –ó–∞–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()
    show_user_notes_cbq = state_data.get('show_user_notes_cbq')

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥ is_forced, –µ—Å–ª–∏ –±—ã–ª –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
    is_forced = state_data.get('edited_note')

    # –û—á–∏—â–∞–µ–º —á–∞—Ç –æ—Ç –∞—É–¥–∏–æ–∑–∞–ø–∏—Å–µ–π –ø—Ä–∏–º–µ—Ä–æ–≤, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
    if state_data.get('audio_examples'):
        audio_msgs = list(state_data.get('audio_examples').values())[0]
        for msg in audio_msgs:
            try:
                await bot.delete_message(callback.message.chat.id, msg.message_id)
            except (Exception, ):
                pass
        await state.update_data(audio_examples=None)

    # –ü–æ–ª—É—á–∞–µ–º id –∑–∞–º–µ—Ç–∫–∏ –∏–∑ callback
    note_id = int(callback.data.split('_')[-1])

    # –ü–æ–ª—É—á–∞–µ–º –æ–±—ä–µ–∫—Ç –∑–∞–º–µ—Ç–∫–∏ –ø–æ id –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –µ–≥–æ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–¥ –∫–ª—é—á–æ–º "edited_note"
    edited_note = await DataBase.get_note_by_id(session, note_id)
    await state.update_data(edited_note=edited_note)

    # –§–æ—Ä–º–∏—Ä—É–µ–º –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    btns = {
        '–ó–∞–≥–æ–ª–æ–≤–æ–∫ üñå': 'edit_note:title',
        '–¢–µ–∫—Å—Ç üñå': 'edit_note:text',
        '–ü—Ä–∏–º–µ—Ä—ã üñå': 'edit_note:examples',
        '–ù–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä ‚ûï': 'add_another_example_to_edited_note',
        '–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É ‚¨Ö': show_user_notes_cbq,
    }
    kbds = get_inline_btns(btns=btns, sizes=(2, 2, 1))
    bot.reply_markup_save[callback.message.chat.id] = kbds

    # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–æ—Å–ª–µ –Ω–µ–∫–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, —Ç–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∑–∞–º–µ—Ç–∫–æ–π
    if is_forced:
        await update_note_msg_data(bot, callback.message.chat.id, state_data, edited_note)

    # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤–∏—á–Ω—ã–π –≤—ã–∑–æ–≤ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, —Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–º–µ—Ç–∫–æ–π –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    else:
        await callback.message.edit_reply_markup(reply_markup=kbds)
        await state.update_data(note_msg=callback.message)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –æ—Ç–º–µ–Ω–∞ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏
@note_router.callback_query(F.data == 'return_to_edit_note_main')
async def return_to_edit_note_main(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –æ—Ç–º–µ–Ω–∞ –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö, –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –º–µ–Ω—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏.
    –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤–≤–æ–¥–∞, —É–¥–∞–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ 'return_to_edit_note_main'
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback
    await callback.answer('‚ö†Ô∏è –î–µ–π—Å—Ç–≤–∏–µ –æ—Ç–º–µ–Ω–µ–Ω–æ!', show_alert=True)            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    await state.set_state(None)                                                     # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞
    await delete_last_message(bot, callback.message.chat.id)                        # –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
@note_router.callback_query(F.data.startswith('edit_note:title') | F.data.startswith('edit_note:text'))
async def edit_note_title_or_text_ask_for_new_data(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
    –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ–±–∞ –∫–µ–π—Å–∞: 'edit_note:title' –∏ 'edit_note:text'.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "edit_note:<title | text>"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
    :return:
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–µ
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –£–¥–∞–ª—è–µ–º –∏–∑ —á–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id, only_examples=True)
    await delete_info_message(bot, callback.message.chat.id, state_data)

    # –ò–∑ callback –∑–∞–±–∏—Ä–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞
    edited_attr = callback.data.split(':')[-1]

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
    current_data = getattr(edited_note, edited_attr)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã –∏ –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    btns = {
        '–û—Ç–º–µ–Ω–∞ ‚ùå': 'return_to_edit_note_main',
        '–¢–µ–∫—Å—Ç —Å–µ–π—á–∞—Å üìù': f'switch_inline_query_current_chat_{current_data}'
    }
    kbds = get_inline_btns(btns=btns)
    msg_attr = '–∑–∞–≥–æ–ª–æ–≤–æ–∫' if edited_attr == 'title' else '—Ç–µ–∫—Å—Ç'
    msg_text = (f'–í–≤–µ–¥–∏—Ç–µ <b>–Ω–æ–≤—ã–π {msg_attr} –∑–∞–º–µ—Ç–∫–∏</b>  –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ <i>"–¢–µ–∫—Å—Ç —Å–µ–π—á–∞—Å üìù"</i> –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –≤ —Å—Ç—Ä–æ–∫—É '
                '–≤–≤–æ–¥–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–æ–±–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.')
    msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)
    await state.update_data(info_msg=msg)

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç—Ä–µ–±—É–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –∏ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –µ–≥–æ
    required_state = NotesFSM.title if edited_attr == 'title' else NotesFSM.text
    await state.set_state(required_state)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –®–ê–ì 2: –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î
@note_router.message(StateFilter(NotesFSM.title, NotesFSM.text), IsKeyInStateFilter('edited_note'))
async def edit_note_get_title_or_text(message: types.Message, bot: Bot, state: FSMContext, session: AsyncSession) \
        -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∏–ª–∏ —Ç–µ–∫—Å—Ç–∞ –∑–∞–º–µ—Ç–∫–∏, –®–ê–ì 2: –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î,
    –≤–æ–∑–≤—Ä–∞—Ç –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º 'edited_note'
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ò–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–±–∏—Ä–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞
    current_state = await state.get_state()                             # NotesFSM:title | NotesFSM:text
    attr_name = current_state.split(':')[-1]

    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–∞–º–∏
    await delete_last_message(bot, message.chat.id)
    await delete_last_message(bot, message.chat.id)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–µ
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏ –≤ –ë–î –∏ –≤—ã–≤–æ–¥–∏–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    is_updated = await DataBase.update_note_by_id(session, edited_note.id, **{attr_name: message.text})
    if is_updated:
        await try_alert_msg(bot, message.chat.id, '‚úÖ –î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!', if_error_send_msg=True)
    else:
        await try_alert_msg(bot, message.chat.id, oops_try_again_msg_template, if_error_send_msg=True)

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∫–Ω—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏
    modified_callback = await modify_callback_data(
        bot.auxiliary_msgs['cbq'][message.chat.id], f'edit_note_{edited_note.id}'
    )
    await edit_note_main(modified_callback, bot, state, session)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞
@note_router.callback_query(F.data == 'add_another_example_to_edited_note', IsKeyInStateFilter('edited_note'))
async def add_another_example_to_edited_note_ask_text(callback: types.CallbackQuery, bot: Bot, state: FSMContext) \
        -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "add_another_example_to_edited_note"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "edited_note"
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –£–¥–∞–ª—è–µ–º –∏–∑ —á–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id, only_examples=True)
    state_data = await state.get_data()
    await delete_info_message(bot, callback.message.chat.id, state_data)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∑–∞–ø—Ä–æ—Å–æ–º –≤–≤–æ–¥–∞ –∏ –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
    kbds = get_inline_btns(btns={'–û—Ç–º–µ–Ω–∞ ‚ùå': 'return_to_edit_note_main'})
    msg_text = '–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç <b>–Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞</b> –∑–∞–º–µ—Ç–∫–∏'
    msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)
    await state.update_data(info_msg=msg)               # –î—É–±–ª–∏—Ä—É–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç, —á—Ç–æ–±—ã —É–¥–∞–ª—è—Ç—å –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤

    # –î–æ–±–∞–≤–ª—è–µ–º –≤ state –∫–ª—é—á 'add_example' –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞
    await state.update_data(add_example=True)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –ø—Ä–∏–º–µ—Ä–∞ –∫ –∑–∞–º–µ—Ç–∫–µ
    await state.set_state(NotesFSM.example)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: —Ç–µ–∫—Å—Ç –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ë–î
@note_router.message(NotesFSM.example, IsKeyInStateFilter('edited_note', 'add_example'))
async def add_another_example_to_edited_note_get_text(message: types.Message, bot: Bot, state: FSMContext,
                                                      session: AsyncSession) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: —Ç–µ–∫—Å—Ç –ø—Ä–∏–º–µ—Ä–∞ –ø–æ–ª—É—á–µ–Ω, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ –ë–î, –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫
    –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∫–Ω—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º –ø—Ä–∏–º–µ—Ä–æ–º
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å –∫–ª—é—á–æ–º 'edited_note' –∏ 'add_example' - –¥–ª—è —Ä–∞–∑–¥–µ–ª–µ–Ω–∏—è —Å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –î–µ–ª–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–≤–æ–¥–∞, –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª—è–µ–º –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if not validate_context_example(message.text):
        msg_text = context_validation_not_passed_msg_template
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        await bot.delete_message(message.chat.id, message.message_id)
        return

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –¥–∞–Ω–Ω—ã–µ
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä Context –≤ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
    try:
        data = {'context': message.text}
        created_example = await DataBase.create_context_example(session, data, note_id=edited_note.id)
        if created_example:
            await try_alert_msg(bot, message.chat.id, '‚úÖ –ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!', if_error_send_msg=True)
    except (Exception, ) as e:
        msg_text = oops_with_error_msg_template.format(error=str(e))
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        return

    # –£–¥–∞–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏–º–µ—Ä–∞ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await delete_info_message(bot, message.chat.id, state_data)
    await delete_last_message(bot, message.chat.id)

    # –£–¥–∞–ª—è–µ–º –∏–∑ state –∫–ª—é—á 'add_example'
    await state.update_data(add_example=None)

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –æ—Å–Ω–æ–≤–Ω–æ–º—É –æ–∫–Ω—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–º–µ—Ç–∫–∏
    modified_callback = await modify_callback_data(
        bot.auxiliary_msgs['cbq'][message.chat.id], f'edit_note_{edited_note.id}'
    )
    await edit_note_main(modified_callback, bot, state, session)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤, –®–ê–ì 1: –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–º–µ—Ä–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è.
# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è
@note_router.callback_query(F.data.contains('edit_note:example'), IsKeyInStateFilter('edited_note'))
async def edit_note_show_examples(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–æ–≤, –®–ê–ì 1: –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∏–º–µ—Ä–æ–≤ —Å –∫–Ω–æ–ø–∫–∞–º–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è.
    –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–∞–∫–∂–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞, –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
    —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ 'edit_note:example' (–∏–ª–∏ –∏–Ω–æ–µ –ø—Ä–∏ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–º –≤—ã–∑–æ–≤–µ)
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º 'edited_note'
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–µ
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–ª—é—á–∞ 'add_example' –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –µ—Å–ª–∏ –µ—Å—Ç—å - —É–¥–∞–ª—è–µ–º
    if state_data.get('add_example'):
        await state.update_data(add_example=None)

    # –£–¥–∞–ª—è–µ–º –∏–∑ —á–∞—Ç–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–µ—Å–ª–∏ –µ—Å—Ç—å)
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id, only_examples=True)
    await delete_info_message(bot, callback.message.chat.id, state_data)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ –∏ –∫–Ω–æ–ø–∫–∞–º–∏ –¥–ª—è –∏—Ö —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
    for example in edited_note.examples:
        msg_text = context_example_msg_template.format(
            example=example.example, created=example.created, updated=example.updated
        )
        kbds = get_inline_btns(
                btns={'–ò–∑–º–µ–Ω–∏—Ç—å üñå': f'update_context_{example.id}', '–£–¥–∞–ª–∏—Ç—å üóë': f'delete_context_{example.id}'}
        )
        msg = await callback.message.answer(text=msg_text, reply_markup=kbds)

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø—Ä–∏–º–µ—Ä–æ–≤
        bot.auxiliary_msgs['example_msgs'][callback.message.chat.id].append(msg)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —É–¥–∞–ª–µ–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
@note_router.callback_query(F.data == 'return_to_edit_note_show_examples')
async def return_to_edit_note_show_examples(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –æ—Ç–º–µ–Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è –∏ –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ (–æ—Ç–º–µ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è –∏–ª–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    –ø—Ä–∏–º–µ—Ä–∞).
    –§—É–Ω–∫—Ü–∏—è —É–¥–∞–ª—è–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –ø–æ–∫–∞–∑ –ø—Ä–∏–º–µ—Ä–æ–≤.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ 'return_to_edit_note_show_examples'
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
    await delete_last_message(bot, callback.message.chat.id)

    # –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞
    await state.set_state(None)

    # –£–¥–∞–ª—è–µ–º –∏–∑ state –∫–ª—é—á 'example_to_update_id' –ø—Ä–∏ –æ—Ç–º–µ–Ω–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    state_data = await state.get_data()
    if state_data.get('example_to_update_id'):
        await state.update_data(example_to_update_id=None)

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤
    await edit_note_show_examples(callback, bot, state)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
@note_router.callback_query(F.data.startswith('delete_context_'), IsKeyInStateFilter('edited_note'))
async def delete_note_example_ask_confirm(callback: types.CallbackQuery, bot: Bot, state: FSMContext) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "delete_context_<Context.id>"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "edited_note"
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –û—á–∏—â–∞–µ–º —á–∞—Ç –æ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏
    for msg in bot.auxiliary_msgs['example_msgs'][callback.message.chat.id]:
        try:
            await bot.delete_message(chat_id=callback.message.chat.id, message_id=msg.message_id)
        except (Exception, ) as e:
            print(e)

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–º–µ—Ç–∫–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()
    edited_note = state_data.get('edited_note')

    # –û–ø—Ä–µ–¥–µ–ª—è–µ–º ID –∏ –æ–±—ä–µ–∫—Ç —É–¥–∞–ª—è–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
    example_to_delete_id = int(callback.data.split('_')[-1])
    example_to_del_obj = list(filter(lambda x: x.id == example_to_delete_id, edited_note.examples))[0]

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º —É–¥–∞–ª–µ–Ω–∏—è –ø—Ä–∏–º–µ—Ä–∞ –∏ –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã –¥–µ–π—Å—Ç–≤–∏—è
    btns = {
        '–£–¥–∞–ª–∏—Ç—å üóë': f'confirm_delete_context_{example_to_delete_id}',
        '–û—Ç–º–µ–Ω–∞ ‚ùå': 'return_to_edit_note_show_examples'
    }
    kbds = get_inline_btns(btns=btns)
    msg_text = f'–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–∏–º–µ—Ä <b>"{example_to_del_obj.example}"</b>?'
    msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤
@note_router.callback_query(F.data.startswith('confirm_delete_context_'), IsKeyInStateFilter('edited_note'))
async def confirm_delete_note_example(callback: types.CallbackQuery, bot: Bot, state: FSMContext,
                                      session: AsyncSession) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—É—á–µ–Ω–æ, —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
    –ø—Ä–∏–º–µ—Ä–æ–≤.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "confirm_delete_context_<Context.id>"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "edited_note"
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ callback ID —É–¥–∞–ª—è–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
    example_to_delete_id = int(callback.data.split('_')[-1])

    # –£–¥–∞–ª—è–µ–º –ø—Ä–∏–º–µ—Ä –∏–∑ –ë–î
    deleted = await DataBase.delete_context_by_id(session, example_to_delete_id)

    # –ï—Å–ª–∏ —É–¥–∞–ª–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if not deleted:
        await try_alert_msg(bot, callback.message.chat.id, oops_try_again_msg_template, if_error_send_msg=True)
        return

    # –ü—Ä–∏ —É—Å–ø–µ—Ö–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
    await try_alert_msg(bot, callback.message.chat.id, f'‚úÖ –ü—Ä–∏–º–µ—Ä —É–¥–∞–ª–µ–Ω!', if_error_send_msg=True)

    # –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
    await delete_last_message(bot, callback.message.chat.id)

    # –û–±–Ω–æ–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–º–µ—Ç–∫–µ —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
    edited_note = await DataBase.get_note_by_id(session, edited_note.id)
    await state.update_data(edited_note=edited_note)

    # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–º–µ—Ç–∫–∏
    await update_note_msg_data(bot, callback.message.chat.id, state_data, edited_note)

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–∞–º–µ—Ç–∫–∏
    await edit_note_show_examples(callback, bot, state)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
@note_router.callback_query(F.data.startswith('update_context_'), IsKeyInStateFilter('edited_note'))
async def update_context_example_ask_new_text(callback: types.CallbackQuery, bot: Bot, state: FSMContext,
                                              session: AsyncSession) -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 1: –∑–∞–ø—Ä–æ—Å –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞.

    :param callback: CallbackQuery-–∑–∞–ø—Ä–æ—Å —Ñ–æ—Ä–º–∞—Ç–∞ "update_context_<Context.id>"
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "edited_note"
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """
    bot.auxiliary_msgs['cbq'][callback.message.chat.id] = callback

    # –£–¥–∞–ª—è–µ–º –ø—Ä–∏–º–µ—Ä—ã –∏–∑ —á–∞—Ç–∞
    await clear_auxiliary_msgs_in_chat(bot, callback.message.chat.id, only_examples=True)

    # –ó–∞–±–∏—Ä–∞–µ–º –∏–∑ callback ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ–≥–æ –≤ state
    example_to_update_id = int(callback.data.split('_')[-1])
    await state.update_data(example_to_update_id=example_to_update_id)

    # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–µ
    context_obj = await DataBase.get_context_by_id(session, example_to_update_id)
    current_data = getattr(context_obj, 'example')

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–Ω–æ–ø–∫–æ–π –æ—Ç–º–µ–Ω—ã –∏ –≤—ã–≤–æ–¥–∞ –≤ —á–∞—Ç —Ç–µ–∫—É—â–µ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞
    msg_text = (f'–í–≤–µ–¥–∏—Ç–µ <b>–Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø—Ä–∏–º–µ—Ä–∞</b> –∏–ª–∏ –Ω–∞–∂–º–∏—Ç–µ <i>"–¢–µ–∫—Å—Ç —Å–µ–π—á–∞—Å üìù"</i> –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ –≤ —Å—Ç—Ä–æ–∫—É '
                '–≤–≤–æ–¥–∞ —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —É–¥–æ–±–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∏.')
    btns = {
        '–û—Ç–º–µ–Ω–∞ ‚ùå': 'return_to_edit_note_show_examples',
        '–¢–µ–∫—Å—Ç —Å–µ–π—á–∞—Å üìù': f'switch_inline_query_current_chat_{current_data}'
    }
    kbds = get_inline_btns(btns=btns)
    msg = await callback.message.answer(text=msg_text, reply_markup=kbds)
    bot.auxiliary_msgs['user_msgs'][callback.message.chat.id].append(msg)
    await state.update_data(info_msg=msg)

    # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–≤–æ–¥–∞ –Ω–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –ø—Ä–∏–º–µ—Ä–∞
    await state.set_state(NotesFSM.example)


# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª—É—á–µ–Ω, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤
@note_router.message(NotesFSM.example, IsKeyInStateFilter('edited_note', 'example_to_update_id'))
async def update_context_example_get_text(message: types.Message, bot: Bot, state: FSMContext, session: AsyncSession) \
        -> None:
    """
    –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–º–µ—Ç–∫–∏ - –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∏–º–µ—Ä–∞, –®–ê–ì 2: –Ω–æ–≤—ã–π —Ç–µ–∫—Å—Ç –ø–æ–ª—É—á–µ–Ω, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ –ë–î, –≤–æ–∑–≤—Ä–∞—Ç –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É
    –ø—Ä–∏–º–µ—Ä–æ–≤.

    :param message: –¢–µ–∫—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏–º–µ—Ä–∞
    :param bot: –û–±—ä–µ–∫—Ç –±–æ—Ç–∞
    :param state: –ö–æ–Ω—Ç–µ–∫—Å—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è FSM —Å –∫–ª—é—á–æ–º "edited_note" –∏ –∫–ª—é—á–æ–º "example_to_update_id" —Å id —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ
                  –ø—Ä–∏–º–µ—Ä–∞ Context
    :param session: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–µ—Å—Å–∏—è
    :return: None
    """

    # –î–µ–ª–∞–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏—é –≤–≤–æ–¥–∞, –ø—Ä–∏ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏ —É–≤–µ–¥–æ–º–ª—è–µ–º –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if not validate_context_example(message.text):
        msg_text = context_validation_not_passed_msg_template
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        await bot.delete_message(message.chat.id, message.message_id)
        return

    # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
    bot.auxiliary_msgs['user_msgs'][message.chat.id].append(message)

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∑–∞–º–µ—Ç–∫–µ –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    state_data = await state.get_data()
    edited_note: Notes = state_data.get('edited_note')

    # –ü–æ–ª—É—á–∞–µ–º ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
    example_to_update_id = state_data.get('example_to_update_id')

    # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä–∞ –≤ –ë–î –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ
    try:
        updated = await DataBase.update_context_by_id(session, example_to_update_id, message.text)
        await try_alert_msg(bot, message.chat.id, f'‚úÖ –ü—Ä–∏–º–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω!', if_error_send_msg=True)
    except (Exception, ) as e:
        msg_text = oops_with_error_msg_template.format(error=str(e))
        await try_alert_msg(bot, message.chat.id, msg_text, if_error_send_msg=True)
        return

    # –ï—Å–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –Ω–µ —É–¥–∞–ª–æ—Å—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–ø–æ–≤–µ—â–µ–Ω–∏–µ –∏ –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏
    if not updated:
        await try_alert_msg(bot, message.chat.id, oops_try_again_msg_template, if_error_send_msg=True)
        await delete_last_message(bot, message.chat.id)
        return

    # –£–¥–∞–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º –∏ —Ç–µ–∫—É—â–∏–º —Ç–µ–∫—Å—Ç–æ–º –ø—Ä–∏–º–µ—Ä–∞
    await delete_last_message(bot, message.chat.id)
    await delete_last_message(bot, message.chat.id)

    # –£–¥–∞–ª—è–µ–º –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ID —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
    await state.update_data(example_to_update_id=None)

    # –û–±–Ω–æ–≤–ª—è–µ–º –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –∑–∞–º–µ—Ç–∫–µ —Å —É—á–µ—Ç–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–π
    edited_note = await DataBase.get_note_by_id(session, edited_note.id)
    await state.update_data(edited_note=edited_note)

    # –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –∑–∞–º–µ—Ç–∫–∏
    await update_note_msg_data(bot, message.chat.id, state_data, edited_note)

    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø—Ä–æ—Å–º–æ—Ç—Ä—É –ø—Ä–∏–º–µ—Ä–æ–≤ –∑–∞–º–µ—Ç–∫–∏
    await edit_note_show_examples(bot.auxiliary_msgs['cbq'][message.chat.id], bot, state)
